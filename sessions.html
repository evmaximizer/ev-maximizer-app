<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>EV Maximizer - My Sessions</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root{--neon:#33c95c;}
*{box-sizing:border-box;}

body{
    background:#050505;
    color:white;
    margin:0;
    display:flex;
    height:100vh;
    font-family:'Share Tech Mono';
}

.sidebar{
    width:240px;
    background:#000;
    border-right:1px solid #1a1a1a;
    padding:25px;
}

.nav-item{
    color:#666;
    text-decoration:none;
    display:block;
    margin-bottom:20px;
    font-family:'Orbitron';
    font-size:11px;
}
.nav-item.active{color:var(--neon);}

.main{
    flex:1;
    padding:20px;
    display:flex;
    flex-direction:column;
    overflow-y:auto;
}

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.buyin-filter{
    background:black;
    border:1px solid var(--neon);
    color:var(--neon);
    font-family:'Orbitron';
    font-size:10px;
    padding:5px;
}

.chart-box{
    background:#0f0f0f;
    padding:20px;
    height:400px;
    margin-bottom:25px;
}

.table-box{
    background:#0f0f0f;
    padding:20px;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:12px;
}

th{
    text-align:left;
    padding:12px;
    border-bottom:1px solid #333;
    color:var(--neon);
    font-family:'Orbitron';
    font-size:10px;
}

td{
    padding:12px;
    border-bottom:1px solid #1a1a1a;
    color:#ccc;
}

tr:hover{
    background:rgba(51,201,92,0.05);
}

.btn-review{
    background:transparent;
    border:1px solid var(--neon);
    color:var(--neon);
    padding:4px 8px;
    font-family:'Orbitron';
    font-size:9px;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
    <div style="text-align:center;margin-bottom:40px;">
        <img src="logotop.png" style="width:120px;">
    </div>
    <a href="dashboard.html" class="nav-item">TERMINAL_DASHBOARD</a>
    <a href="sessions.html" class="nav-item active">MY_SESSIONS</a>
</div>

<div class="main">

    <div class="header">
        <h3 style="font-family:'Orbitron';font-size:13px;">
            TECHNICAL_PERFORMANCE_ANALYSIS
        </h3>

        <select id="buyinFilter" class="buyin-filter" onchange="loadData()">
            <option value="all">ALL_BUYINS</option>
            <option value="1">€1</option>
            <option value="5">€5</option>
        </select>
    </div>

    <div class="chart-box">
        <canvas id="techChart"></canvas>
    </div>

    <div class="table-box">
        <table>
            <thead>
                <tr>
                    <th>DATE</th>
                    <th>BUYIN</th>
                    <th>HANDS</th>
                    <th>NET €</th>
                    <th>VPIP</th>
                    <th>EV DIFF</th>
                    <th>AI</th>
                </tr>
            </thead>
            <tbody id="session-table-body"></tbody>
        </table>
    </div>

</div>

<script>

let techChart;

function initChart(){
    techChart = new Chart(document.getElementById('techChart'),{
        type:'line',
        data:{
            labels:[],
            datasets:[
                {label:'NET WON',borderColor:'#33c95c',data:[],tension:0.3},
                {label:'ALL-IN EV',borderColor:'#ffaa00',data:[],tension:0.3},
                {label:'RED LINE',borderColor:'#ff4444',data:[],tension:0.3},
                {label:'BLUE LINE',borderColor:'#4488ff',data:[],tension:0.3}
            ]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{
                    labels:{color:'#aaa',font:{size:9}}
                }
            }
        }
    });
}

async function loadData(){
    try{
        const buyin=document.getElementById('buyinFilter').value;
        const res=await fetch(`http://127.0.0.1:5000/get-sessions?buyin=${buyin}`);
        const d=await res.json();

        const tbody=document.getElementById("session-table-body");
        tbody.innerHTML="";

        d.sessions.forEach(s=>{
            tbody.innerHTML+=`
                <tr>
                    <td>${s.date}</td>
                    <td>€${s.buyin}</td>
                    <td>${s.total_hands}</td>
                    <td style="color:${s.net_profit>=0?'#33c95c':'#ff4444'}">
                        € ${s.net_profit.toFixed(2)}
                    </td>
                    <td>${s.vpip}%</td>
                    <td style="color:${s.ev_diff>=0?'#33c95c':'#ff4444'}">
                        ${s.ev_diff}
                    </td>
                    <td>
                        <button class="btn-review">REVIEW_AI</button>
                    </td>
                </tr>
            `;
        });

        if(d.chart_data){
            techChart.data.labels=d.chart_data.labels;
            techChart.data.datasets[0].data=d.chart_data.net;
            techChart.data.datasets[1].data=d.chart_data.ev;
            techChart.data.datasets[2].data=d.chart_data.red;
            techChart.data.datasets[3].data=d.chart_data.blue;
            techChart.update();
        }

    }catch(e){
        console.log("DB offline");
    }
}

window.onload=()=>{initChart();loadData();};

</script>

</body>
</html>
