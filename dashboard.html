<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>EV Maximizer - Operational Terminal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #33c95c; --bg: #050505; --card-bg: #0f0f0f; --cyan: #00e5ff; }
        body { background: var(--bg); color: white; font-family: 'Share Tech Mono', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 280px; background: #000; border-right: 1px solid #1a1a1a; padding: 25px; display: flex; flex-direction: column; }
        .logo-text { font-family: 'Orbitron'; font-weight: 900; font-size: 24px; letter-spacing: 3px; color: var(--neon); text-shadow: 0 0 15px rgba(51,201,92,0.3); margin-bottom: 40px; }
        .main { flex: 1; padding: 30px; overflow-y: auto; background: radial-gradient(circle at 50% 50%, #0a0a0a 0%, #050505 100%); }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
        .card { background: var(--card-bg); border: 1px solid #1a1a1a; padding: 20px; border-left: 3px solid var(--neon); }
        .card-label { font-size: 10px; color: #666; letter-spacing: 2px; }
        .card-value { font-size: 22px; font-family: 'Orbitron'; margin-top: 10px; }
        .chart-box { background: var(--card-bg); border: 1px solid #1a1a1a; padding: 20px; height: 450px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo-text">EV_MAXIMIZER</div>
        <div style="color: var(--neon); font-size: 10px;">> SYSTEM_ACTIVE</div>
        <div style="margin-top: 20px; color: #444; font-size: 11px;">DATA_SOURCE: SQLITE_CORE</div>
    </div>
    <div class="main">
        <div class="stats-grid">
            <div class="card"><div class="card-label">NET_PROFIT</div><div class="card-value" id="total-profit">€ 0.00</div></div>
            <div class="card"><div class="card-label">TOTAL_HANDS</div><div class="card-value" id="hands-val">0</div></div>
            <div class="card"><div class="card-label">AVG_VPIP</div><div class="card-value" id="vpip-val">0%</div></div>
            <div class="card"><div class="card-label">SESSIONS</div><div class="card-value" id="sessions-val">0</div></div>
        </div>
        <div class="chart-box">
            <canvas id="perfChart"></canvas>
        </div>
    </div>

    <script>
        let chart;
        function init() {
            const ctx = document.getElementById('perfChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ 
                    label: 'Profit (€)', 
                    data: [], 
                    borderColor: '#33c95c', 
                    backgroundColor: 'rgba(51, 201, 92, 0.1)',
                    fill: true,
                    tension: 0.3 
                }]},
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: { 
                        y: { grid: { color: '#1a1a1a' }, ticks: { color: '#666' } },
                        x: { grid: { color: '#1a1a1a' }, ticks: { color: '#666' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        async function update() {
            try {
                const res = await fetch('http://127.0.0.1:5000/get-stats');
                const data = await res.json();
                if (data.status === "success") {
                    document.getElementById('total-profit').innerText = "€ " + data.total_profit.toFixed(2);
                    document.getElementById('hands-val').innerText = data.total_hands;
                    document.getElementById('vpip-val').innerText = data.avg_vpip + "%";
                    document.getElementById('sessions-val').innerText = data.labels.length;

                    chart.data.labels = data.labels;
                    chart.data.datasets[0].data = data.net;
                    chart.update('none'); // Update fluido in tempo reale
                }
            } catch (e) { console.error("Sync Error"); }
        }

        window.onload = () => { init(); update(); setInterval(update, 5000); };
    </script>
</body>
</html>